<!DOCTYPE html PUBLIC "-
<html xmlns="http:
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Font Upgrade</title>
<style type="text/css">
html, body {
	height: 100%;
}
</style>
<script type="text/javascript">

function loadImage() {

	var FONT_CODE = stripComments($('font-code').value);
	var FONT_CODE_WIDTH = stripComments($('font-width').value).split(',').map(function (x) {return trim(x) * 1});
	var FONT_CODE_STEP = $('font-step').value * 1;
	var FONT_CODE_HEIGHT = $('font-height').value * 1;

	console.log(FONT_CODE);

	var src = FONT_CODE.split(",").map(function (x){return trim(x).replace("0b", "")});
	// $('binary_out').value = src.join("+");

	var rv = "prog_uchar FONT_NAME [] PROGMEM = {";
	for(var i = 0; i < 64; ++i){
		sb = i * FONT_CODE_STEP;
		rv += "\n\t";
		for(j = 0; j < FONT_CODE_WIDTH[i]; ++j) {
			maxK = Math.ceil(FONT_CODE_HEIGHT/4);
			for (k = 0; k < maxK; k += 2) {
				if (k + 1 == maxK) {
					rv += "0b" + ("0000" + src[sb + 2*j + k]).split("").reverse().join("") + ", ";
				} else {
					rv += "0b" + (src[sb + 2*j + (k + 1)] + "" + src[sb + 2*j + k]).split("").reverse().join("") + ", ";
				}
			}
		}
		rv += " // " + String.fromCharCode(32 + i);
	}

	rv += "\n};\n\n\n\nint FONT_NAME_END [] = {";

	sum = 0;
	for (var i = 0; i < FONT_CODE_WIDTH.length; i++) {
		sum += FONT_CODE_WIDTH[i];
		if (i % 8 == 0) {
			rv += "\n\t";
		}
		rv += ("    " + sum).slice(-4) + ",";
	};

	rv = rv.substring(0, rv.length - 1); // Remove the trailing ,
	rv += "\n};";

	$('binary_out').innerHTML = rv;
}

function stripComments(str){
	return str.replace(/\/\/.*$/gm, '');
}

function trim(str) {
	return str.replace(/^\s\s*/, '').replace(/\s\s*$/, '');
}

function $(e){
	return document.getElementById(e);
}

window.addEventListener("load", loadImage, false);
</script>
</head>

<body>
Font Code:
<textarea id="font-code" style="width: 100%; height: 200px;">
  0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // SPACE
  0b1111, 0b1101, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // !
  0b0011, 0b0000, 0b0000, 0b0000, 0b0011, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // "
  0b1010, 0b0000, 0b1111, 0b0001, 0b1010, 0b0000, 0b1111, 0b0001, 0b1010, 0b0000,  // #
  0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // $
  0b0011, 0b0001, 0b1011, 0b0000, 0b0100, 0b0000, 0b1010, 0b0001, 0b1001, 0b0001,  // %
  0b1010, 0b0000, 0b0101, 0b0001, 0b1001, 0b0001, 0b1010, 0b0001, 0b0000, 0b0000,  // &
  0b0011, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // '
  
  0b1110, 0b0000, 0b0001, 0b0001, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // (
  0b0001, 0b0001, 0b1110, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // )
  0b0101, 0b0000, 0b0010, 0b0000, 0b0101, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // *
  0b0100, 0b0000, 0b0100, 0b0000, 0b1111, 0b0001, 0b0100, 0b0000, 0b0100, 0b0000,  // +
  0b0000, 0b0001, 0b1000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // ,
  0b0100, 0b0000, 0b0100, 0b0000, 0b0100, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // -
  0b0000, 0b0001, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // .
  0b0000, 0b0001, 0b1100, 0b0000, 0b0110, 0b0000, 0b0001, 0b0000, 0b0000, 0b0000,  // /
  
  0b1110, 0b0111, 0b0001, 0b1000, 0b1110, 0b0111, 0b0000, 0b0000, 0b0000, 0b0000,  // 0
  0b0010, 0b1000, 0b1111, 0b1111, 0b0000, 0b1000, 0b0000, 0b0000, 0b0000, 0b0000,  // 1
  0b0010, 0b1110, 0b0001, 0b1001, 0b1110, 0b1000, 0b0000, 0b0000, 0b0000, 0b0000,  // 2
  0b0001, 0b1001, 0b0001, 0b1001, 0b1111, 0b1111, 0b0000, 0b0000, 0b0000, 0b0000,  // 3
  0b1111, 0b0000, 0b1000, 0b0000, 0b1111, 0b1111, 0b0000, 0b0000, 0b0000, 0b0000,  // 4
  0b1111, 0b1000, 0b1001, 0b1000, 0b1001, 0b1111, 0b0000, 0b0000, 0b0000, 0b0000,  // 5
  0b1111, 0b1111, 0b1001, 0b1000, 0b1001, 0b1111, 0b0000, 0b0000, 0b0000, 0b0000,  // 6
  0b0001, 0b1111, 0b1001, 0b0000, 0b0111, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000,  // 7
  
  0b1111, 0b1111, 0b1001, 0b1000, 0b1111, 0b1111, 0b0000, 0b0000, 0b0000, 0b0000,  // 8
  0b1111, 0b1000, 0b1001, 0b1000, 0b1111, 0b1111, 0b0000, 0b0000, 0b0000, 0b0000,  // 9
  0b0100, 0b0010, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, // :
  0b0000, 0b0001, 0b1010, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, // ;
  0b0100, 0b0000, 0b1010, 0b0000, 0b0001, 0b0001, 0b0000, 0b0000, 0b0000, 0b0000, // <
  0b1010, 0b0000, 0b1010, 0b0000, 0b1010, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, // =
  0b0001, 0b0001, 0b1010, 0b0000, 0b0100, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, // >
  0b0010, 0b0000, 0b0001, 0b0000, 0b1001, 0b0001, 0b0110, 0b0000, 0b0000, 0b0000, // ?
  
  0b1110, 0b0000, 0b0001, 0b0000, 0b1101, 0b0000, 0b0101, 0b0001, 0b1111, 0b0000, // @
  0b1111, 0b1111, 0b1001, 0b0000, 0b1001, 0b0000, 0b1111, 0b1111, 0b0000, 0b0000, // A
  0b1111, 0b1111, 0b1001, 0b1000, 0b1001, 0b1000, 0b0111, 0b1111, 0b0000, 0b0000, // B
  0b1111, 0b1111, 0b0001, 0b1000, 0b0001, 0b1000, 0b0011, 0b1100, 0b0000, 0b0000, // C
  0b1111, 0b1111, 0b0001, 0b1000, 0b0001, 0b1000, 0b1110, 0b0111, 0b0000, 0b0000, // D
  0b1111, 0b1111, 0b1001, 0b1000, 0b1001, 0b1000, 0b0001, 0b1000, 0b0000, 0b0000, // E
  0b1111, 0b1111, 0b1001, 0b0000, 0b1001, 0b0000, 0b0001, 0b0000, 0b0000, 0b0000, // F
  0b1111, 0b1111, 0b0001, 0b1000, 0b1001, 0b1000, 0b1001, 0b1111, 0b0000, 0b0000, // G
  
  0b1111, 0b1111, 0b1000, 0b0000, 0b1000, 0b0000, 0b1111, 0b1111, 0b0000, 0b0000, // H
  0b0001, 0b1000, 0b1111, 0b1111, 0b0001, 0b1000, 0b0000, 0b0000, 0b0000, 0b0000, // I
  0b0001, 0b1100, 0b0001, 0b1000, 0b0001, 0b1000, 0b1111, 0b1111, 0b0000, 0b0000, // J
  0b1111, 0b1111, 0b1000, 0b0000, 0b0100, 0b0001, 0b0011, 0b1110, 0b0000, 0b0000, // K
  0b1111, 0b1111, 0b0000, 0b1000, 0b0000, 0b1000, 0b0000, 0b1000, 0b0000, 0b0000, // L
  0b1111, 0b1111, 0b0110, 0b0000, 0b0110, 0b0000, 0b1111, 0b1111, 0b0000, 0b0000, // M  
  0b1111, 0b1111, 0b1100, 0b0000, 0b0000, 0b0011, 0b1111, 0b1111, 0b0000, 0b0000, // N
  0b1111, 0b1111, 0b0001, 0b1000, 0b0001, 0b1000, 0b1111, 0b1111, 0b0000, 0b0000, // O
  
  0b1111, 0b1111, 0b1001, 0b0000, 0b1001, 0b0000, 0b1111, 0b0000, 0b0000, 0b0000, // P
  0b1111, 0b1111, 0b0001, 0b1010, 0b0001, 0b1100, 0b1111, 0b1111, 0b0000, 0b0000, // Q
  0b1111, 0b1111, 0b1001, 0b0000, 0b1001, 0b0001, 0b1111, 0b1110, 0b0000, 0b0000, // R
  0b1111, 0b1000, 0b1001, 0b1000, 0b1001, 0b1000, 0b1001, 0b1111, 0b0000, 0b0000, // S
  0b0001, 0b0000, 0b1111, 0b1111, 0b0001, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, // T  
  0b1111, 0b1111, 0b0000, 0b1000, 0b0000, 0b1000, 0b1111, 0b1111, 0b0000, 0b0000, // U
  0b1111, 0b0011, 0b0000, 0b1110, 0b0000, 0b1110, 0b1111, 0b0011, 0b0000, 0b0000, // V
  0b1111, 0b0111, 0b0000, 0b1111, 0b0000, 0b1110, 0b1111, 0b0111, 0b0000, 0b0000, // W
  
  0b0111, 0b1110, 0b1100, 0b0011, 0b1100, 0b0011, 0b0111, 0b1110, 0b0000, 0b0000, // X
  0b0111, 0b0000, 0b1000, 0b1111, 0b0111, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, // Y
  0b0001, 0b1100, 0b0001, 0b1011, 0b1101, 0b1000, 0b0011, 0b1000, 0b0000, 0b0000, // Z
  0b1111, 0b0001, 0b0001, 0b0001, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, // [
  0b0001, 0b0000, 0b0110, 0b0000, 0b1100, 0b0000, 0b0000, 0b0001, 0b0000, 0b0000, // backslash
  0b0001, 0b0001, 0b1111, 0b0001, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, // ]
  0b0010, 0b0000, 0b0001, 0b0000, 0b0010, 0b0000, 0b0000, 0b0000, 0b0000, 0b0000, // ^
  0b0000, 0b0001, 0b0000, 0b0001, 0b0000, 0b0001, 0b0000, 0b0000, 0b0000, 0b0000  // _
</textarea><br />
Font-Width array:
<textarea id="font-width" style="width: 100%; height: 100px;">
  1, 3, 3, 4, 4, 4, 4, 1,  // spc to '
  3, 3, 4, 4, 2, 4, 2, 4,  // ( to /
  4, 3, 4, 4, 4, 4, 4, 4,  // 0 to 7
  4, 4, 1, 2, 4, 4, 4, 4,  // 8 to ?
  4, 4, 4, 4, 4, 4, 4, 4,  // @ to G
  4, 3, 4, 4, 4, 4, 4, 4,  // H to O
  4, 4, 4, 4, 4, 4, 4, 4,  // P to W
  4, 4, 4, 3, 4, 3, 4, 5   // X to _
</textarea><br />
Font step: <input type="number" id="font-step" min="1" value="10" />  Font height: <input type="number" id="font-height" min="1" value="8" /><br />
<button onclick="loadImage()">Load</button><br />
<pre id="binary_out" style="width: 100%; height: 100%;"></pre>
</body>
</html>
